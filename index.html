<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyOonh3hs174bKBczUMnFlDADobMt7W9UgkRUEzztuhL5uI9H6cifhcUp6s2blwBYEF/exec";

function drawName() {
  const psno = document.getElementById("psno").value.trim();
  if (!psno) {
    alert("Please enter PS No");
    return;
  }

  // One device = one identity
  let deviceId = localStorage.getItem("device_id");
  if (!deviceId) {
    deviceId = crypto.randomUUID();
    localStorage.setItem("device_id", deviceId);
  }

  fetch(API_URL, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      psno: psno,
      device: deviceId
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.error) {
      alert(data.error);
    } else {
      document.getElementById("result").style.display = "block";
      document.getElementById("result").innerText =
        "ðŸŽ You got: " + data.success;

      // lock this device forever
      localStorage.setItem("drawDone", "true");
    }
  })
  .catch(err => {
    alert("Connection error. Please try again.");
    console.error(err);
  });
}
</script>
