<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbzOAzqiQ2aFJU9omfQeDPC0h_PThCO7hpaCPmudBJXMZv-MRPozRN-BS_uJJsTGUjus/exec";

function drawName() {
  const psno = document.getElementById("psno").value.trim();
  if (!psno) {
    alert("Please enter PS No");
    return;
  }

  // Simple device id (safe everywhere)
  let deviceId = localStorage.getItem("device_id");
  if (!deviceId) {
    deviceId = "DEV-" + Date.now();
    localStorage.setItem("device_id", deviceId);
  }

  const formData = new FormData();
  formData.append("psno", psno);
  formData.append("device", deviceId);

  fetch(API_URL + "?t=" + Date.now(), {
    method: "POST",
    body: formData
  })
  .then(res => res.text())
  .then(result => {
    if (result === "INVALID_PS") {
      alert("âŒ Invalid PS Number");
    } else if (result === "PS_USED") {
      alert("âš ï¸ PS Number already used");
    } else if (result === "NO_NAMES") {
      alert("ðŸŽ„ All names assigned");
    } else {
      document.getElementById("result").innerText =
        "ðŸŽ You got: " + result;
    }
  })
  .catch(err => {
    console.error(err);
    alert("Network error");
  });
}
</script>
